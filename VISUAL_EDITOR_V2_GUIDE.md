# ビジュアル編集機能 v2 - 完全ガイド

## ✅ 完成しました！

**日時**: 2026-02-18  
**最新コミット**: `db13561` - "fix(admin): すべての管理ページからビジュアル編集v2へリンク"

---

## 🎯 主な改善点

### **1. 管理ページからアクセス可能**
すべての管理ページのサイドバーに「ビジュアル編集 v2」リンクを追加しました：
- ダッシュボード
- ブログ記事管理
- イベント管理
- ニュースレター管理
- 学校規則管理
- いじめ防止方針管理

### **2. ホームページとの自動連動**
ビジュアル編集v2で保存したデータは**自動的にホームページに反映**されます：

**データの流れ**:
```
ビジュアル編集v2で編集
    ↓
保存ボタンをクリック
    ↓
/api/tables/site_settings に保存
    ↓
home.js が同じAPIから読み込み
    ↓
ホームページに自動反映 ✅
```

**キャッシュについて**:
- home.jsは5分間のキャッシュを使用
- 最大5分以内に変更が反映されます
- すぐに確認したい場合は、ブラウザのハードリロード（Ctrl+Shift+R / Cmd+Shift+R）

---

## 📖 使い方

### **アクセス方法**

#### **方法1: 管理ダッシュボードから**
1. 管理画面にログイン（`https://kametsu-homepage.netlify.app/admin-login`）
2. 左サイドバーの「ビジュアル編集 v2」をクリック
3. 編集画面が開きます

#### **方法2: 直接アクセス**
```
https://kametsu-homepage.netlify.app/visual-editor-v2
```

### **編集手順**

1. **セクションを選択**
   - 上部のドロップダウンから編集したいセクションを選択
   - 例: ヘッダー、ヒーローセクション、学校紹介など

2. **内容を編集**
   - 左側のフォームに表示される各フィールドを編集
   - 入力と同時に右側のプレビューがリアルタイムで更新されます

3. **プレビューを確認**
   - 右側のプレビュー画面で見た目を確認
   - デバイス切り替えボタンで表示を変更可能
     - デスクトップ（1200px）
     - タブレット（768px）
     - モバイル（375px）

4. **保存**
   - 下部の「保存」ボタンをクリック
   - ローディング表示後、成功メッセージが表示されます
   - データベースに保存され、ホームページに反映されます

5. **キャンセル（オプション）**
   - 変更を破棄したい場合は「キャンセル」ボタン
   - 元の値に戻ります

---

## 🎨 編集可能なセクション

### **1. ヘッダー（ロゴ・連絡先）**
- 学校名
- モットー
- 電話番号
- メールアドレス

### **2. ヒーローセクション**
- メインタイトル
- サブタイトル
- ボタン1テキスト
- ボタン2テキスト

### **3. ニュースセクション**
- セクションタイトル
- リンクテキスト

### **4. 学校紹介セクション**
- セクションタイトル
- リード文
- 説明文（第1段落）
- 説明文（第2段落）
- ボタンテキスト

### **5. 教育の特色セクション**
- セクションタイトル
- 特色1〜4（各タイトル、説明文）

### **6. 行事予定セクション**
- セクションタイトル
- リンクテキスト

### **7. フッター**
- 学校名
- 住所
- 電話番号
- メールアドレス
- コピーライト

---

## 🔍 動作確認方法

### **1. ビジュアル編集v2での編集**
1. ビジュアル編集v2にアクセス
2. 「ヘッダー」セクションを選択
3. 「学校名」を変更（例: "徳之島町立亀津小学校 TEST"）
4. 保存ボタンをクリック
5. 成功メッセージを確認

### **2. ホームページでの確認**
1. ホームページにアクセス（`https://kametsu-homepage.netlify.app/`）
2. ハードリロード（Ctrl+Shift+R / Cmd+Shift+R）
3. ヘッダーの学校名が変更されていることを確認 ✅

### **3. コンソールでの確認**
開発者ツール（F12）→ Consoleタブで以下を確認：
```
✅ Loaded settings: 34 items
✅ Save complete
```

---

## 📊 技術仕様

### **データベース**
- **テーブル**: `site_settings`
- **保存形式**: キーバリュー形式
- **例**:
  ```json
  {
    "setting_key": "header_school_name",
    "setting_value": "徳之島町立亀津小学校",
    "setting_group": "header",
    "description": "ヘッダーの学校名"
  }
  ```

### **APIエンドポイント**
- **読み込み**: `GET /api/tables/site_settings?limit=100`
- **更新**: `PATCH /api/tables/site_settings/{id}`
- **作成**: `POST /api/tables/site_settings`

### **フロントエンド連動**
- **ファイル**: `public/static/js/home.js`
- **関数**: `loadDynamicContent()`
- **更新間隔**: 5分キャッシュ（変更を確認する場合はハードリロード）

---

## 🚀 デプロイ状況

- **GitHub**: `junkwarrior11/kametsu_homepage` main ブランチ
- **最新コミット**: `db13561`
- **Netlify**: 自動デプロイ完了（約1-2分）
- **公開URL**: https://kametsu-homepage.netlify.app/

---

## ⚠️ 注意事項

1. **保存は必須**
   - プレビューは即座に更新されますが、保存ボタンを押さないとデータベースには保存されません

2. **キャッシュについて**
   - ホームページは5分間キャッシュを使用
   - すぐに確認したい場合はハードリロード

3. **ブラウザキャッシュ**
   - 変更が反映されない場合は、ブラウザキャッシュをクリア

4. **複数人での編集**
   - 同時に複数人が編集すると、後から保存した人の内容で上書きされます
   - 編集前に最新の状態か確認してください

---

## 🎉 完成！

これでビジュアル編集機能v2の設定が完了しました。

**質問や問題があればお知らせください！** 🚀
