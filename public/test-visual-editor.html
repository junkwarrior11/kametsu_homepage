<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ - è¨ºæ–­ãƒ†ã‚¹ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #ccc;
        }
        
        .status.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .status.loading {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .test-section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        #console-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid transparent;
        }
        
        .log-entry.success {
            border-color: #28a745;
            color: #4caf50;
        }
        
        .log-entry.error {
            border-color: #dc3545;
            color: #f44336;
        }
        
        .log-entry.info {
            border-color: #17a2b8;
            color: #00bcd4;
        }
        
        iframe {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ - è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h1>
        
        <div id="status-container"></div>
        
        <div class="test-section">
            <h2>1. APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testAPI()">APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="api-result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. iframeèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testIframe()">iframeãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="iframe-result"></div>
            <iframe id="test-iframe" style="display:none;"></iframe>
        </div>
        
        <div class="test-section">
            <h2>3. ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testCoreLibrary()">ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="core-result"></div>
        </div>
        
        <div class="test-section">
            <h2>4. å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="runFullTest()">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        </div>
        
        <div id="console-log">
            <div class="log-entry info">ğŸ“‹ è¨ºæ–­ãƒ­ã‚°ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</div>
        </div>
    </div>

    <script>
        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        const consoleLog = document.getElementById('console-log');
        
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleLog.appendChild(entry);
            consoleLog.scrollTop = consoleLog.scrollHeight;
            
            // å…ƒã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
            console.log(message);
        }
        
        // 1. APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div class="status loading">â³ APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>';
            addLog('ğŸš€ APIãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                // ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
                const endpoints = [
                    '/api/tables/site_settings?limit=1',
                    '/api/health',
                    '/api/tables/blog_posts?limit=1'
                ];
                
                const results = [];
                
                for (const endpoint of endpoints) {
                    try {
                        addLog(`Testing: ${endpoint}`, 'info');
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        
                        results.push({
                            endpoint,
                            status: response.status,
                            ok: response.ok,
                            hasData: !!data
                        });
                        
                        addLog(`âœ… ${endpoint} - Status: ${response.status}`, 'success');
                    } catch (error) {
                        results.push({
                            endpoint,
                            error: error.message
                        });
                        addLog(`âŒ ${endpoint} - Error: ${error.message}`, 'error');
                    }
                }
                
                resultDiv.innerHTML = `
                    <div class="status success">
                        âœ… APIãƒ†ã‚¹ãƒˆå®Œäº†<br>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ APIãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}</div>`;
                addLog(`âŒ APIãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // 2. iframeèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testIframe() {
            const resultDiv = document.getElementById('iframe-result');
            const iframe = document.getElementById('test-iframe');
            
            resultDiv.innerHTML = '<div class="status loading">â³ iframeãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>';
            addLog('ğŸš€ iframeãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            return new Promise((resolve) => {
                const timeout = setTimeout(() => {
                    resultDiv.innerHTML = '<div class="status error">âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ10ç§’ï¼‰</div>';
                    addLog('âŒ iframeãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ', 'error');
                    iframe.style.display = 'none';
                    resolve(false);
                }, 10000);
                
                iframe.onload = () => {
                    clearTimeout(timeout);
                    resultDiv.innerHTML = '<div class="status success">âœ… iframeæ­£å¸¸ã«ãƒ­ãƒ¼ãƒ‰</div>';
                    addLog('âœ… iframeãƒ­ãƒ¼ãƒ‰æˆåŠŸ', 'success');
                    iframe.style.display = 'block';
                    resolve(true);
                };
                
                iframe.onerror = () => {
                    clearTimeout(timeout);
                    resultDiv.innerHTML = '<div class="status error">âŒ iframeãƒ­ãƒ¼ãƒ‰å¤±æ•—</div>';
                    addLog('âŒ iframeãƒ­ãƒ¼ãƒ‰å¤±æ•—', 'error');
                    iframe.style.display = 'none';
                    resolve(false);
                };
                
                addLog('Loading: index.html', 'info');
                iframe.src = 'index.html?_=' + Date.now();
            });
        }
        
        // 3. ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆ
        function testCoreLibrary() {
            const resultDiv = document.getElementById('core-result');
            addLog('ğŸš€ ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            const checks = [];
            
            // toast ã®ãƒã‚§ãƒƒã‚¯
            if (window.toast) {
                checks.push('âœ… window.toast exists');
                addLog('âœ… window.toast ãŒåˆ©ç”¨å¯èƒ½', 'success');
            } else {
                checks.push('âŒ window.toast missing');
                addLog('âŒ window.toast ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
            
            // loading ã®ãƒã‚§ãƒƒã‚¯
            if (window.loading) {
                checks.push('âœ… window.loading exists');
                addLog('âœ… window.loading ãŒåˆ©ç”¨å¯èƒ½', 'success');
            } else {
                checks.push('âŒ window.loading missing');
                addLog('âŒ window.loading ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
            
            // api ã®ãƒã‚§ãƒƒã‚¯
            if (window.api) {
                checks.push('âœ… window.api exists');
                addLog('âœ… window.api ãŒåˆ©ç”¨å¯èƒ½', 'success');
            } else {
                checks.push('âŒ window.api missing');
                addLog('âŒ window.api ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
            
            const allPassed = checks.every(c => c.startsWith('âœ…'));
            
            resultDiv.innerHTML = `
                <div class="status ${allPassed ? 'success' : 'error'}">
                    ${checks.join('<br>')}
                </div>
            `;
        }
        
        // 4. å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ
        async function runFullTest() {
            addLog('ğŸš€ğŸš€ğŸš€ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            await testAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testIframe();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testCoreLibrary();
            
            addLog('ğŸ‰ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸè¨ºæ–­
        window.addEventListener('DOMContentLoaded', () => {
            addLog('ğŸ“‹ è¨ºæ–­ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
            addLog('â„¹ï¸ å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨ºæ–­ã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
        });
    </script>
</body>
</html>
